<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Automation Dashboard - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr 300px;
            gap: 15px;
            height: calc(100vh - 30px);
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            color: white;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .panel h2 {
            margin-bottom: 15px;
            font-size: 1.3em;
            text-align: center;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8em;
            position: relative;
        }
        
        .status-card .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: absolute;
            top: 8px;
            right: 8px;
        }
        
        .status-card.online .status-indicator {
            background: #2ecc71;
            box-shadow: 0 0 8px #2ecc71;
        }
        
        .status-card.offline .status-indicator {
            background: #95a5a6;
        }
        
        .status-card.loading .status-indicator {
            background: #f39c12;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .stats {
            font-size: 0.7em;
            margin-top: 5px;
            opacity: 0.8;
        }
        
        .input-group {
            margin-bottom: 12px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 13px;
            backdrop-filter: blur(5px);
        }
        
        .input-group input::placeholder, .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 3px;
            font-size: 12px;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #666;
        }
        
        .btn.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        .btn.warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        .screenshot-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin: 10px 0;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .screenshot-area:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(78, 205, 196, 0.6);
        }
        
        .screenshot-area.drag-over {
            background: rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
        }
        
        .ai-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .ai-section h3 {
            font-size: 1em;
            margin-bottom: 10px;
            color: #4ecdc4;
        }
        
        .ai-models {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .model-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.8em;
            border: 2px solid transparent;
        }
        
        .model-card:hover:not(.loading) {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.02);
        }
        
        .model-card.selected {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }
        
        .model-card.online::after {
            content: '●';
            color: #2ecc71;
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 12px;
        }
        
        .model-card.loading::after {
            content: '⏳';
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 12px;
            animation: pulse 1.5s infinite;
        }
        
        .model-card.offline {
            opacity: 0.6;
        }
        
        .loading-estimate {
            font-size: 0.7em;
            color: #f39c12;
            margin-top: 3px;
        }
        
        .output {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 11px;
            height: 200px;
            overflow-y: auto;
            flex-grow: 1;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .task-history {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 12px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 11px;
            height: 100%;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .task-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        
        .task-entry.error {
            color: #ff4757;
        }
        
        .task-entry.warning {
            color: #ffa502;
        }
        
        .task-entry.success {
            color: #2ed573;
        }
        
        .task-entry.chained {
            margin-left: 20px;
            border-left: 2px solid rgba(255, 255, 255, 0.2);
            padding-left: 10px;
        }
        
        .server-controls {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        
        .server-controls .btn {
            font-size: 10px;
            padding: 6px 10px;
        }
        
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 10px;
            }
            
            .panel {
                height: auto;
            }
            
            .output, .task-history {
                height: 150px;
            }
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            color: white;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: white;
        }
        
        .script-content {
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        .capture-menu {
            display: none;
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 5px;
            z-index: 100;
            min-width: 150px;
        }
        
        .capture-menu.show {
            display: block;
        }
        
        .capture-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .capture-menu-item:hover {
            background: rgba(78, 205, 196, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Screen Understanding & Web Control Panel -->
        <div class="panel">
            <h2>🖥️ Screen Control & Web Automation</h2>
            
            <div class="status-grid">
                <div class="status-card online" id="browserUseCard">
                    <div class="status-indicator"></div>
                    <strong>Browser Use</strong>
                    <div class="stats" id="browserUseStats">Connected</div>
                </div>
                <div class="status-card online" id="axiomCard">
                    <div class="status-indicator"></div>
                    <strong>Axiom.ai</strong>
                    <div class="stats" id="axiomStats">Ready</div>
                </div>
                <div class="status-card online" id="webDriverCard">
                    <div class="status-indicator"></div>
                    <strong>WebDriver</strong>
                    <div class="stats" id="webDriverStats">Active</div>
                </div>
                <div class="status-card online" id="visionCard">
                    <div class="status-indicator"></div>
                    <strong>AI Vision</strong>
                    <div class="stats" id="visionStats">Loaded</div>
                </div>
            </div>
            
            <div class="input-group">
                <label>Screen Capture</label>
                <div class="screenshot-area" id="screenshotArea">
                    <div>📸 Click to capture screen</div>
                    <div style="font-size: 0.9em; opacity: 0.7; margin-top: 5px;">
                        Choose: Full Screen • Tab • Window • Region
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.7; margin-top: 5px;">
                        or drag & drop image
                    </div>
                    <input type="file" accept="image/*" style="display: none;" id="imageInput">
                </div>
                <div class="capture-menu" id="captureMenu">
                    <div class="capture-menu-item" onclick="captureScreenMode('full')">🖥️ Full Screen</div>
                    <div class="capture-menu-item" onclick="captureScreenMode('tab')">📑 Active Tab</div>
                    <div class="capture-menu-item" onclick="captureScreenMode('window')">🪟 Window</div>
                    <div class="capture-menu-item" onclick="captureScreenMode('region')">📐 Select Region</div>
                </div>
            </div>
            
            <div class="input-group">
                <label>AI Instruction</label>
                <textarea placeholder="Describe what you want the AI to do..." rows="2" id="webInstruction"></textarea>
            </div>
            
            <div class="input-group">
                <label>Target</label>
                <input type="url" placeholder="URL or application name" id="targetUrl">
            </div>
            
            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                <button class="btn" onclick="executeWebTask()" id="executeBtn">🤖 Execute</button>
                <button class="btn" onclick="startAutomation()" id="startAutoBtn">▶️ Start Auto</button>
                <button class="btn danger" onclick="stopAutomation()" id="stopAutoBtn" disabled>⏹️ Stop</button>
                <button class="btn" onclick="observeScreen()" id="observeBtn">👁️ Observe</button>
            </div>
            
            <div class="output" id="webOutput"></div>
        </div>
        
        <!-- Local AI & PowerShell Panel -->
        <div class="panel">
            <h2>⚡ Local AI & PowerShell Control</h2>
            
            <div class="ai-section">
                <h3>🤖 AI Models (Load On Demand)</h3>
                <div class="ai-models">
                    <div class="model-card offline" onclick="toggleModel('jan')" id="janModel">
                        <strong>Jan AI</strong><br>
                        <small id="janStatus">Click to load</small>
                        <div class="loading-estimate" id="janEstimate"></div>
                    </div>
                    <div class="model-card offline" onclick="toggleModel('lmstudio')" id="lmstudioModel">
                        <strong>LM Studio</strong><br>
                        <small id="lmstudioStatus">Click to load</small>
                        <div class="loading-estimate" id="lmstudioEstimate"></div>
                    </div>
                    <div class="model-card offline" onclick="toggleModel('offlineai')" id="offlineaiModel">
                        <strong>OfflineAI</strong><br>
                        <small id="offlineaiStatus">Click to load</small>
                        <div class="loading-estimate" id="offlineaiEstimate"></div>
                    </div>
                    <div class="model-card offline" onclick="toggleModel('ollama')" id="ollamaModel">
                        <strong>Ollama</strong><br>
                        <small id="ollamaStatus">Click to load</small>
                        <div class="loading-estimate" id="ollamaEstimate"></div>
                    </div>
                </div>
            </div>
            
            <div class="server-controls">
                <button class="btn" onclick="showServerStatus()" id="showStatusBtn">📊 Status</button>
                <button class="btn danger" onclick="terminateServers()" id="terminateBtn">🚫 Terminate</button>
                <button class="btn warning" onclick="uninstallAI()" id="uninstallBtn">🗑️ Uninstall</button>
                <button class="btn" onclick="showInstallScript()" id="installScriptBtn">📋 Install Script</button>
            </div>
            
            <div class="input-group">
                <label>PowerShell Task (Using: <span id="selectedAILabel">Web AI</span>)</label>
                <textarea placeholder="Describe the PowerShell task..." rows="2" id="psInstruction"></textarea>
            </div>
            
            <div class="input-group">
                <label>Execution Mode</label>
                <select id="executionMode">
                    <option value="generate">Generate Only</option>
                    <option value="execute">Generate & Execute</option>
                    <option value="interactive">Interactive</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                <button class="btn" onclick="generatePowerShell()" id="generateBtn">📝 Generate</button>
                <button class="btn" onclick="executePowerShell()" id="executePSBtn" disabled>⚡ Execute</button>
                <button class="btn" onclick="downloadScript()" id="downloadBtn" disabled>💾 Download</button>
            </div>
            
            <div class="output" id="psOutput"></div>
        </div>
        
        <!-- Status & History Panel -->
        <div class="panel">
            <h2>📊 Status & Task History</h2>
            
            <div class="ai-section">
                <h3>🚀 System Status</h3>
                <div id="systemStats" style="font-size: 0.85em;">
                    <div>CPU Usage: <span id="cpuUsage">--</span>%</div>
                    <div>Memory: <span id="memUsage">--</span>%</div>
                    <div>Active Processes: <span id="processCount">--</span></div>
                    <div>Network: <span id="networkStatus">--</span></div>
                </div>
            </div>
            
            <h3 style="font-size: 1em; margin: 10px 0; color: #4ecdc4;">Task History</h3>
            <div class="task-history" id="taskHistory"></div>
        </div>
    </div>

    <!-- Installation Script Modal -->
    <div id="installModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>🚀 Local AI Installation Script</h2>
            <p>This PowerShell script will automatically install and configure all local AI services:</p>
            
            <div class="script-content" id="scriptContent"></div>
            
            <div style="margin-top: 20px;">
                <button class="btn" onclick="downloadInstallScript()">💾 Download Script</button>
                <button class="btn" onclick="copyScript()">📋 Copy to Clipboard</button>
                <button class="btn danger" onclick="executeInstallScript()">⚡ Execute Now</button>
            </div>
        </div>
    </div>

    <script>
        // Global state management
        let selectedModel = null;
        let automationActive = false;
        let aiServers = {
            jan: { status: 'offline', port: 8001, pid: null, loadTime: 15 },
            lmstudio: { status: 'offline', port: 8002, pid: null, loadTime: 20 },
            offlineai: { status: 'offline', port: 8003, pid: null, loadTime: 12 },
            ollama: { status: 'offline', port: 8004, pid: null, loadTime: 10 }
        };
        let webServices = {
            browserUse: { status: 'online', connected: true },
            axiom: { status: 'online', connected: true },
            webDriver: { status: 'online', connected: true },
            vision: { status: 'online', loaded: true }
        };
        let taskHistory = [];
        let capturedScreen = null;
        let currentScript = '';

        // Initialize on load
        window.onload = function() {
            logTask('🎉 Dashboard initialized successfully');
            logTask('🌐 Web services active and ready');
            logTask('💡 Click any AI model to load it on demand');
            updateSystemStats();
            setInterval(updateSystemStats, 5000);
            setInterval(updateServiceStatus, 3000);
            updateButtonStates();
        };

        // Task logging with history
        function logTask(message, type = 'info', isChained = false) {
            const timestamp = new Date().toLocaleTimeString();
            const entry = {
                time: timestamp,
                message: message,
                type: type,
                chained: isChained
            };
            
            taskHistory.push(entry);
            
            const historyEl = document.getElementById('taskHistory');
            const entryEl = document.createElement('div');
            entryEl.className = `task-entry ${type} ${isChained ? 'chained' : ''}`;
            entryEl.textContent = `[${timestamp}] ${message}`;
            
            historyEl.appendChild(entryEl);
            historyEl.scrollTop = historyEl.scrollHeight;
        }

        // Toggle AI model on/off
        function toggleModel(modelName) {
            const model = aiServers[modelName];
            
            if (model.status === 'loading') {
                logTask(`⚠️ ${modelName.toUpperCase()} is still loading, please wait`, 'warning');
                return;
            }
            
            if (model.status === 'offline') {
                startAIModel(modelName);
            } else if (model.status === 'online') {
                selectModel(modelName);
            }
        }

        // Start AI model on demand
        function startAIModel(modelName) {
            const model = aiServers[modelName];
            model.status = 'loading';
            
            const card = document.getElementById(modelName + 'Model');
            const statusEl = document.getElementById(modelName + 'Status');
            const estimateEl = document.getElementById(modelName + 'Estimate');
            
            card.classList.remove('offline', 'online');
            card.classList.add('loading');
            statusEl.textContent = 'Loading...';
            
            logTask(`🚀 Loading ${modelName.toUpperCase()}...`);
            
            let countdown = model.loadTime;
            estimateEl.textContent = `~${countdown}s`;
            logTask(`⏱️ Estimated load time: ${countdown} seconds`, 'info', true);
            
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    estimateEl.textContent = `~${countdown}s`;
                }
            }, 1000);
            
            setTimeout(() => {
                clearInterval(countdownInterval);
                model.status = 'online';
                model.pid = Math.floor(Math.random() * 10000) + 1000;
                
                card.classList.remove('loading');
                card.classList.add('online');
                statusEl.textContent = `Port: ${model.port}`;
                estimateEl.textContent = '';
                
                logTask(`✅ ${modelName.toUpperCase()} loaded successfully (PID: ${model.pid})`, 'success', true);
                
                // Auto-select first available AI
                if (!selectedModel) {
                    selectModel(modelName);
                }
                
                updateButtonStates();
            }, model.loadTime * 1000);
        }

        // Select AI model
        function selectModel(modelName) {
            if (aiServers[modelName].status !== 'online') {
                return;
            }
            
            // Deselect all
            document.querySelectorAll('.model-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select this one
            document.getElementById(modelName + 'Model').classList.add('selected');
            selectedModel = modelName;
            
            document.getElementById('selectedAILabel').textContent = modelName.toUpperCase();
            
            logTask(`🤖 Selected AI model: ${modelName.toUpperCase()}`);
            updateButtonStates();
        }

        // Screen capture with menu
        document.getElementById('screenshotArea').addEventListener('click', function(e) {
            if (e.target.id === 'imageInput') return;
            
            const menu = document.getElementById('captureMenu');
            const rect = this.getBoundingClientRect();
            
            menu.style.left = rect.left + 'px';
            menu.style.top = (rect.bottom + 5) + 'px';
            menu.classList.toggle('show');
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('captureMenu');
            const area = document.getElementById('screenshotArea');
            
            if (!area.contains(e.target) && !menu.contains(e.target)) {
                menu.classList.remove('show');
            }
        });

        function captureScreenMode(mode) {
            document.getElementById('captureMenu').classList.remove('show');
            
            logTask(`📸 Capturing ${mode} screen...`);
            
            const modes = {
                full: 'Full screen captured (1920x1080)',
                tab: 'Active browser tab captured',
                window: 'Active window captured',
                region: 'Selected region captured (400x300)'
            };
            
            setTimeout(() => {
                capturedScreen = {
                    mode: mode,
                    timestamp: new Date(),
                    size: modes[mode]
                };
                
                logTask(`✅ Screen capture completed: ${modes[mode]}`, 'success', true);
                
                const screenshotArea = document.getElementById('screenshotArea');
                screenshotArea.innerHTML = `<div>📸 ${file.name}</div><div style="font-size: 0.9em; opacity: 0.7; margin-top: 5px;">${(file.size / 1024).toFixed(1)}KB - Ready for analysis</div>`;
                screenshotArea.style.background = 'rgba(46, 204, 113, 0.1)';
                screenshotArea.style.borderColor = '#2ecc71';
            }, 1000);
        }

        // Web automation functions
        function executeWebTask() {
            const instruction = document.getElementById('webInstruction').value;
            const target = document.getElementById('targetUrl').value;
            
            if (!instruction.trim()) {
                logTask('❌ Web task failed: No instruction provided', 'error');
                return;
            }
            
            const aiUsed = selectedModel ? selectedModel.toUpperCase() : 'Web AI';
            logTask(`🤖 Executing web task with ${aiUsed}`);
            logTask(`Task: "${instruction.substring(0, 50)}..."`, 'info', true);
            
            setTimeout(() => {
                if (capturedScreen) {
                    logTask(`🔍 Analyzing ${capturedScreen.mode} capture...`, 'info', true);
                    logTask(`🎯 Target: ${target || 'Current screen'}`, 'info', true);
                    logTask(`⚡ AI processing instruction...`, 'info', true);
                    logTask(`✅ Web task completed successfully`, 'success', true);
                } else {
                    logTask(`⚠️ No screen capture available, using current view`, 'warning', true);
                    logTask(`✅ Web task completed with limited context`, 'success', true);
                }
            }, 2000);
        }

        function startAutomation() {
            automationActive = true;
            logTask('▶️ Starting continuous automation mode');
            logTask('👁️ Monitoring screen for changes...', 'info', true);
            
            document.getElementById('startAutoBtn').disabled = true;
            document.getElementById('stopAutoBtn').disabled = false;
        }

        function stopAutomation() {
            automationActive = false;
            logTask('⏹️ Automation stopped');
            
            document.getElementById('startAutoBtn').disabled = false;
            document.getElementById('stopAutoBtn').disabled = true;
        }

        function observeScreen() {
            logTask('👁️ Starting screen observation mode');
            
            setTimeout(() => {
                logTask('📊 Screen analysis complete:', 'success', true);
                logTask('• 5 interactive elements detected', 'info', true);
                logTask('• 3 buttons identified', 'info', true);
                logTask('• 2 input fields found', 'info', true);
                logTask('• Ready for automation commands', 'info', true);
            }, 1500);
        }

        // PowerShell functions
        function generatePowerShell() {
            const instruction = document.getElementById('psInstruction').value;
            
            if (!instruction.trim()) {
                logTask('❌ PowerShell generation failed: No instruction provided', 'error');
                return;
            }
            
            const aiUsed = selectedModel ? selectedModel.toUpperCase() : 'Web AI';
            
            logTask(`📝 Generating PowerShell script with ${aiUsed}`);
            logTask(`Task: "${instruction.substring(0, 50)}..."`, 'info', true);
            
            setTimeout(() => {
                currentScript = generateScriptFromInstruction(instruction, aiUsed);
                logTask('✅ PowerShell script generated successfully', 'success', true);
                
                const output = document.getElementById('psOutput');
                output.innerHTML += `\n\n# Generated PowerShell Script:\n${currentScript}`;
                output.scrollTop = output.scrollHeight;
                
                document.getElementById('executePSBtn').disabled = false;
                document.getElementById('downloadBtn').disabled = false;
            }, 2000);
        }

        function executePowerShell() {
            if (!currentScript) {
                logTask('❌ No script to execute - generate one first', 'error');
                return;
            }
            
            const mode = document.getElementById('executionMode').value;
            const aiUsed = selectedModel ? selectedModel.toUpperCase() : 'Web AI';
            
            logTask(`⚡ Executing PowerShell script (${mode} mode) with ${aiUsed}`);
            
            setTimeout(() => {
                logTask('🔐 Checking execution policy...', 'info', true);
                logTask('✅ Execution authorized', 'success', true);
                logTask('🔄 Running PowerShell commands...', 'info', true);
                
                const results = [
                    '📊 Process: chrome.exe - CPU: 15.2% - Memory: 523MB',
                    '📊 Process: code.exe - CPU: 8.7% - Memory: 412MB',
                    '📊 Process: powershell.exe - CPU: 5.1% - Memory: 89MB'
                ];
                
                results.forEach(result => {
                    logTask(result, 'info', true);
                });
                
                logTask('✅ PowerShell execution completed successfully', 'success', true);
            }, 1500);
        }

        function downloadScript() {
            if (!currentScript) {
                logTask('❌ No script available to download', 'error');
                return;
            }
            
            const blob = new Blob([currentScript], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai-generated-script-${Date.now()}.ps1`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            logTask('💾 PowerShell script downloaded successfully', 'success');
        }

        function generateScriptFromInstruction(instruction, aiModel) {
            const timestamp = new Date().toISOString();
            return `# AI-Generated PowerShell Script
# Generated: ${timestamp}
# AI Model: ${aiModel}
# Task: ${instruction}

# Script execution
Write-Host "Starting task: ${instruction}" -ForegroundColor Cyan
Write-Host "Generated by: ${aiModel}" -ForegroundColor Yellow

# Example commands based on common tasks
Get-Process | Sort-Object CPU -Descending | Select-Object -First 10 | Format-Table -AutoSize

# Additional task-specific commands would be generated here based on the instruction

Write-Host "Task completed successfully" -ForegroundColor Green`;
        }

        // Server management
        function showServerStatus() {
            logTask('📊 Retrieving server status...');
            
            setTimeout(() => {
                logTask('🖥️ AI Server Status:', 'success', true);
                
                for (let model in aiServers) {
                    const server = aiServers[model];
                    if (server.status === 'online') {
                        logTask(`✅ ${model.toUpperCase()}: Running (PID: ${server.pid}, Port: ${server.port})`, 'success', true);
                    } else if (server.status === 'loading') {
                        logTask(`⚠️ ${model.toUpperCase()}: Loading...`, 'warning', true);
                    } else {
                        logTask(`⚪ ${model.toUpperCase()}: Not loaded`, 'info', true);
                    }
                }
                
                logTask('🌐 Web Services:', 'success', true);
                for (let service in webServices) {
                    const srv = webServices[service];
                    if (srv.status === 'online') {
                        logTask(`✅ ${service}: Connected and ready`, 'success', true);
                    } else {
                        logTask(`❌ ${service}: Disconnected`, 'error', true);
                    }
                }
            }, 500);
        }

        function terminateServers() {
            const onlineModels = Object.keys(aiServers).filter(m => aiServers[m].status === 'online');
            
            if (onlineModels.length === 0) {
                logTask('⚠️ No AI servers running', 'warning');
                return;
            }
            
            const confirmed = confirm(`⚠️ Are you sure you want to terminate ${onlineModels.length} running AI server(s)?`);
            if (!confirmed) return;
            
            logTask('🚫 Terminating AI servers...', 'warning');
            
            onlineModels.forEach(model => {
                logTask(`🛑 Stopping ${model.toUpperCase()} (PID: ${aiServers[model].pid})...`, 'warning', true);
                
                setTimeout(() => {
                    aiServers[model].status = 'offline';
                    aiServers[model].pid = null;
                    
                    const card = document.getElementById(model + 'Model');
                    const statusEl = document.getElementById(model + 'Status');
                    
                    card.classList.remove('online', 'selected');
                    card.classList.add('offline');
                    statusEl.textContent = 'Click to load';
                    
                    logTask(`✅ ${model.toUpperCase()} terminated`, 'success', true);
                    
                    if (selectedModel === model) {
                        selectedModel = null;
                        document.getElementById('selectedAILabel').textContent = 'Web AI';
                    }
                    
                    updateButtonStates();
                }, Math.random() * 800 + 200);
            });
        }

        function uninstallAI() {
            const confirmed = confirm('⚠️ WARNING: This will uninstall all local AI services and delete their data. Continue?');
            if (!confirmed) return;
            
            logTask('🗑️ Starting uninstallation process...', 'warning');
            
            // Terminate first
            Object.keys(aiServers).forEach(model => {
                if (aiServers[model].status === 'online') {
                    logTask(`🛑 Stopping ${model.toUpperCase()}...`, 'warning', true);
                    aiServers[model].status = 'offline';
                }
            });
            
            setTimeout(() => {
                logTask('🗑️ Removing installation files...', 'warning', true);
                logTask('🗑️ Cleaning up directories...', 'warning', true);
                logTask('🗑️ Removing configuration files...', 'warning', true);
                logTask('🗑️ Clearing registry entries...', 'warning', true);
                logTask('✅ Uninstallation completed successfully', 'success', true);
                logTask('💡 Use "Install Script" button to reinstall services', 'info', true);
            }, 2000);
        }

        // Installation script modal
        function showInstallScript() {
            const modal = document.getElementById('installModal');
            const scriptContent = document.getElementById('scriptContent');
            
            scriptContent.textContent = getInstallationScript();
            modal.style.display = 'block';
            
            logTask('📋 Installation script displayed');
        }

        function closeModal() {
            document.getElementById('installModal').style.display = 'none';
        }

        function getInstallationScript() {
            return `# Local AI Services Installation Script
# Generated: ${new Date().toISOString()}
# This script installs and configures all local AI services

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "Local AI Services Installation" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan

# Check if running as Administrator
if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Warning "Please run this script as Administrator!"
    Exit
}

# Create installation directory
$InstallPath = "C:\\LocalAI"
if (!(Test-Path $InstallPath)) {
    New-Item -ItemType Directory -Path $InstallPath | Out-Null
    Write-Host "Created installation directory: $InstallPath" -ForegroundColor Green
}

# Install Chocolatey (if not installed)
Write-Host "Checking for Chocolatey..." -ForegroundColor Yellow
if (!(Get-Command choco -ErrorAction SilentlyContinue)) {
    Write-Host "Installing Chocolatey..." -ForegroundColor Yellow
    Set-ExecutionPolicy Bypass -Scope Process -Force
    [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
    Invoke-Expression ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
}

# Install Node.js
Write-Host "Installing Node.js..." -ForegroundColor Yellow
choco install nodejs -y

# Install Python
Write-Host "Installing Python..." -ForegroundColor Yellow
choco install python -y

# Refresh environment
refreshenv

# Install Ollama
Write-Host "Installing Ollama..." -ForegroundColor Yellow
$OllamaUrl = "https://ollama.ai/download/OllamaSetup.exe"
$OllamaInstaller = "$env:TEMP\\OllamaSetup.exe"
Invoke-WebRequest -Uri $OllamaUrl -OutFile $OllamaInstaller
Start-Process -FilePath $OllamaInstaller -ArgumentList "/S" -Wait
Write-Host "Ollama installed successfully" -ForegroundColor Green

# Install Jan AI
Write-Host "Installing Jan AI..." -ForegroundColor Yellow
$JanUrl = "https://github.com/janhq/jan/releases/latest/download/jan-win-x64.exe"
$JanInstaller = "$InstallPath\\jan-installer.exe"
Invoke-WebRequest -Uri $JanUrl -OutFile $JanInstaller
Start-Process -FilePath $JanInstaller -ArgumentList "/S" -Wait
Write-Host "Jan AI installed successfully" -ForegroundColor Green

# Install Python packages for OfflineAI
Write-Host "Installing Python packages for OfflineAI..." -ForegroundColor Yellow
pip install transformers torch sentencepiece accelerate

# Create startup scripts
Write-Host "Creating startup scripts..." -ForegroundColor Yellow

# Ollama startup
$OllamaStart = @"
@echo off
echo Starting Ollama on port 8004...
ollama serve
"@
$OllamaStart | Out-File "$InstallPath\\start-ollama.bat" -Encoding ASCII

# Jan startup
$JanStart = @"
@echo off
echo Starting Jan AI...
start "" "C:\\Users\\%USERNAME%\\AppData\\Local\\Programs\\Jan\\Jan.exe"
"@
$JanStart | Out-File "$InstallPath\\start-jan.bat" -Encoding ASCII

# Combined startup
$StartAll = @"
@echo off
echo ========================================
echo Starting All Local AI Services
echo ========================================

echo Starting Ollama...
start "Ollama" cmd /c "$InstallPath\\start-ollama.bat"
timeout /t 2 /nobreak > nul

echo Starting Jan AI...
start "Jan" cmd /c "$InstallPath\\start-jan.bat"
timeout /t 2 /nobreak > nul

echo Starting LM Studio...
start "" "C:\\Users\\%USERNAME%\\AppData\\Local\\Programs\\LM Studio\\LM Studio.exe"

echo.
echo All services started!
pause
"@
$StartAll | Out-File "$InstallPath\\start-all-ai.bat" -Encoding ASCII

Write-Host "" 
Write-Host "========================================" -ForegroundColor Green
Write-Host "Installation Complete!" -ForegroundColor Green
Write-Host "========================================" -ForegroundColor Green
Write-Host ""
Write-Host "Installation Path: $InstallPath" -ForegroundColor Cyan
Write-Host ""
Write-Host "To start all services:" -ForegroundColor Yellow
Write-Host "$InstallPath\\start-all-ai.bat" -ForegroundColor White
Write-Host ""
Write-Host "Individual services:" -ForegroundColor Yellow
Write-Host "- Ollama: $InstallPath\\start-ollama.bat" -ForegroundColor White
Write-Host "- Jan AI: $InstallPath\\start-jan.bat" -ForegroundColor White
Write-Host ""`;
        }

        function downloadInstallScript() {
            const script = getInstallationScript();
            const blob = new Blob([script], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'install-local-ai.ps1';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            logTask('💾 Installation script downloaded', 'success');
        }

        function copyScript() {
            const script = getInstallationScript();
            navigator.clipboard.writeText(script).then(() => {
                logTask('📋 Installation script copied to clipboard', 'success');
                alert('Script copied to clipboard!');
            }).catch(() => {
                logTask('❌ Failed to copy script to clipboard', 'error');
            });
        }

        function executeInstallScript() {
            logTask('⚡ Installation script execution initiated', 'warning');
            logTask('⚠️ Please run the downloaded script as Administrator', 'warning', true);
            logTask('💡 The script will install all required AI services', 'info', true);
            
            downloadInstallScript();
        }

        // Update button states
        function updateButtonStates() {
            const hasOnlineAI = Object.values(aiServers).some(s => s.status === 'online');
            
            // Buttons are always enabled for web services, but can use local AI if available
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('downloadBtn').disabled = !currentScript;
        }

        // Update system stats
        function updateSystemStats() {
            document.getElementById('cpuUsage').textContent = (Math.random() * 40 + 20).toFixed(1);
            document.getElementById('memUsage').textContent = (Math.random() * 30 + 50).toFixed(1);
            document.getElementById('processCount').textContent = Math.floor(Math.random() * 50 + 150);
            document.getElementById('networkStatus').textContent = 'Online';
        }

        // Update service status
        function updateServiceStatus() {
            if (webServices.browserUse.status === 'online') {
                document.getElementById('browserUseStats').textContent = 'Active | Requests: ' + Math.floor(Math.random() * 100);
            }
            if (webServices.axiom.status === 'online') {
                document.getElementById('axiomStats').textContent = 'Ready | Bots: ' + Math.floor(Math.random() * 5);
            }
            if (webServices.webDriver.status === 'online') {
                document.getElementById('webDriverStats').textContent = 'Connected | Sessions: ' + Math.floor(Math.random() * 3);
            }
            if (webServices.vision.status === 'online') {
                document.getElementById('visionStats').textContent = 'Loaded | Accuracy: 94%';
            }
        }

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('installModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html> `<div>📸 ${modes[mode]}</div><div style="font-size: 0.9em; opacity: 0.7; margin-top: 5px;">Ready for AI analysis</div>`;
                screenshotArea.style.background = 'rgba(46, 204, 113, 0.1)';
                screenshotArea.style.borderColor = '#2ecc71';
                
                updateButtonStates();
            }, 1000);
        }

        // Drag and drop functionality
        const screenshotArea = document.getElementById('screenshotArea');
        
        screenshotArea.addEventListener('dragenter', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.classList.add('drag-over');
        });
        
        screenshotArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.classList.add('drag-over');
        });
        
        screenshotArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            e.stopPropagation();
            if (e.target === this) {
                this.classList.remove('drag-over');
            }
        });
        
        screenshotArea.addEventListener('drop', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                const file = files[0];
                handleImageUpload(file);
            } else {
                logTask('❌ Please drop an image file', 'error');
            }
        });

        // File input handler
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                handleImageUpload(file);
            }
        });

        function handleImageUpload(file) {
            logTask(`📁 Image uploaded: ${file.name}`);
            logTask('🔍 Processing image with AI vision...', 'info', true);
            
            setTimeout(() => {
                capturedScreen = {
                    mode: 'uploaded',
                    timestamp: new Date(),
                    size: `${file.name} (${(file.size / 1024).toFixed(1)}KB)`
                };
                
                logTask('✅ Image processed and ready for automation', 'success', true);
                
                const screenshotArea = document.getElementById('screenshotArea');
                screenshotArea.innerHTML =