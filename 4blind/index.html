<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapture Accessible - Screen Capture for Blind Users</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <!-- Skip to main content for screen readers -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Voice command status indicator -->
    <div id="voice-status" class="voice-status" role="status" aria-live="polite" aria-label="Voice command status"></div>

    <div class="container">
        <header role="banner">
            <h1>Rapture Accessible</h1>
            <p>Voice-Enabled Screen Capture & AI Analysis for Blind Users</p>
            <div class="status-announcements" role="status" aria-live="polite" aria-label="System status"></div>
        </header>

        <main id="main-content" role="main">
            <!-- Status Announcements - Hidden at top for screen readers -->
            <div class="status-announcements" role="status" aria-live="polite" aria-label="System status" style="position: absolute; left: -9999px;"></div>

            <!-- Control Panel - Top Section -->
            <section class="control-panel" role="region" aria-labelledby="control-panel-heading">
                <h2 id="control-panel-heading">Rapture Accessible Control Panel</h2>


                <!-- Main Controls -->
                <div class="main-controls">
                    <div class="control-group">
                        <h3>Screen Capture</h3>
                        <div class="button-group">
                            <button id="manualScreenCapture" class="btn btn-primary" aria-describedby="manual-screen-desc">
                                üì∏ Manual Screen Capture
                            </button>
                            <button id="emergencyCapture" class="btn btn-danger" aria-describedby="emergency-capture-desc">
                                üö® Emergency Capture
                            </button>
                        </div>
                    </div>


                    <div class="control-group">
                        <h3>Analysis & Actions</h3>
                        <div class="button-group">
                            <button id="analyzeCapture" class="btn btn-info" disabled aria-describedby="analyze-current-desc">
                                ü§ñ Analyze Current Capture
                            </button>
                            <button id="readAloud" class="btn btn-success" disabled aria-describedby="read-aloud-desc">
                                üîä Read Analysis Aloud
                            </button>
                            <button id="saveCapture" class="btn btn-primary" disabled aria-describedby="save-capture-desc">
                                üíæ Save Capture
                            </button>
                        </div>
                    </div>

                </div>


                <!-- Settings - Simplified AI Configuration -->
                <details class="settings-details">
                    <summary>‚öôÔ∏è AI Configuration</summary>
                    <div class="settings-content">
                        <div class="setting-group">
                            <label for="aiProviderSelect">AI Provider:</label>
                            <select id="aiProviderSelect" aria-describedby="ai-provider-desc">
                                <option value="web-llama" selected>Llama 3.2 (Web) (Free)</option>
                                <option value="web-gpt">GPT-4o Mini (Web) (Free)</option>
                                <option value="web-claude">Claude 3.5 (Web) (Free)</option>
                                <option value="huggingface">Hugging Face (Free)</option>
                                <option value="puter-gemini">Google Gemini (Puter) (Free)</option>
                                <option value="web-gemini">Google Gemini (Web) (Free)</option>
                                <option value="openai">OpenAI GPT-4o (Free Tier)</option>
                                <option value="anthropic">Anthropic Claude (Free)</option>
                                <option value="google">Google Gemini (Free)</option>
                                <option value="cohere">Cohere (Free)</option>
                            </select>
                        </div>

                        <div class="setting-group" id="apiKeyGroup" style="display: none;">
                            <label for="apiKeyInput">API Key:</label>
                            <input type="password" id="apiKeyInput" placeholder="Enter your API key" aria-describedby="api-key-desc">
                            <button id="saveApiKey" class="btn btn-small">Save Key</button>
                            <button id="clearApiKey" class="btn btn-small btn-danger">Clear</button>
                        </div>

                        <div class="setting-group">
                            <label for="autoAnalyzeToggle">Auto-analyze after capture:</label>
                            <input type="checkbox" id="autoAnalyzeToggle" checked aria-describedby="auto-analyze-desc">
                        </div>

                        <div class="ai-status" id="aiStatus">
                            <div class="status-item">
                                <span class="status-label">Current AI:</span>
                                <span class="status-value" id="currentAI">Hugging Face</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Status:</span>
                                <span class="status-value" id="aiConnectionStatus">Ready</span>
                            </div>
                        </div>
                    </div>
                </details>
            </section>

            <!-- Live Preview & Analysis - Compact Layout -->
            <section class="preview-analysis-section" role="region" aria-labelledby="preview-heading">
                <div class="split-view">
                    <!-- Left: Preview -->
                    <div class="preview-panel">
                        <h3 id="preview-heading">Live Preview</h3>
                        <div class="preview-container">
                            <video id="previewVideo" autoplay muted style="display: none;" aria-label="Live video preview"></video>
                            <canvas id="previewCanvas" style="display: none;" aria-label="Screen capture preview"></canvas>
                            <img id="previewImage" alt="Screen capture preview" style="display: none;" aria-label="Screen capture image">
                            <div id="previewPlaceholder" class="preview-placeholder">
                                No preview available. Use capture buttons above to begin.
                            </div>
                        </div>
                    </div>

                    <!-- Right: Analysis -->
                    <div class="analysis-panel">
                        <h3>AI Analysis Results</h3>
                        <div class="analysis-content">
                            <textarea id="aiDescription" placeholder="AI analysis will appear here after capture..." readonly aria-label="AI analysis results"></textarea>
                        </div>
                        <div class="analysis-actions">
                            <button id="reanalyze" class="btn btn-small btn-secondary" disabled>üîÑ Re-analyze</button>
                            <button id="askQuestion" class="btn btn-small btn-info">‚ùì Ask Question</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Recent Captures - Compact Gallery -->
            <section class="captures-section" role="region" aria-labelledby="captures-heading">
                <div class="section-header">
                    <h3 id="captures-heading">Recent Captures</h3>
                    <div class="section-actions">
                        <button id="clearAll" class="btn btn-small btn-danger">üóëÔ∏è Clear All</button>
                        <button id="exportAll" class="btn btn-small btn-info">üìÑ Export</button>
                    </div>
                </div>
                <div id="capturesList" class="captures-grid" role="list" aria-label="Recent captures list"></div>
            </section>




            <!-- Enhanced Bottom Status Bar -->
            <div class="bottom-status-bar">
                <!-- Left Section - System Stats -->
                <div class="status-left">
                    <div class="status-item">
                        <span class="status-label">Storage:</span>
                        <span class="status-value" id="storageUsed">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Memory:</span>
                        <span class="status-value" id="memoryUsage">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Captures:</span>
                        <span class="status-value" id="capturesCount">-</span>
                    </div>
                </div>

                <!-- Center Section - Current Activity & Progress -->
                <div class="status-center">
                    <div class="activity-row">
                        <span id="currentActivity" class="current-activity">Ready</span>
                    </div>
                    <div class="progress-row">
                        <span class="status-text">Ready for capture and analysis</span>
                    </div>
                </div>

                <!-- Right Section - Controls & Recent Announcements -->
                <div class="status-right">
                    <div class="status-controls">
                        <button id="speakStatus" class="btn btn-info btn-small" aria-describedby="speak-status-desc">
                            üîä Speak Status
                        </button>
                        <button id="quickHelp" class="btn btn-secondary btn-small" title="Quick Help">
                            ‚ùì Help
                        </button>
                    </div>

                </div>
            </div>


        </main>
    </div>

    <!-- API Key Dialog -->
    <div id="apiKeyDialog" class="dialog-overlay" style="display: none;" role="dialog" aria-labelledby="dialog-title" aria-modal="true">
        <div class="dialog-content">
            <div class="dialog-header">
                <h2 id="dialog-title">API Key Required</h2>
                <button id="dialogClose" class="dialog-close" aria-label="Close dialog">&times;</button>
            </div>
            <div class="dialog-body">
                <div class="provider-info" id="providerInfo">
                    <h3 id="providerName">Provider Name</h3>
                    <p id="providerDescription">Provider description and setup instructions.</p>
                    <div class="api-key-input-group">
                        <label for="dialogApiKey">API Key:</label>
                        <input type="password" id="dialogApiKey" placeholder="Enter your API key" aria-describedby="api-key-help">
                        <button id="testApiKey" class="btn btn-small">Test Key</button>
                    </div>
                    <div id="api-key-help" class="help-text">
                        Enter your API key for the selected provider. The key will be stored locally and used only for analysis requests.
                    </div>
                </div>
                <div class="free-alternatives">
                    <h4>Free AI Alternatives:</h4>
                    <div class="alternatives-grid" id="alternativesGrid">
                        <!-- Free alternatives will be populated here -->
                    </div>
                </div>
            </div>
            <div class="dialog-footer">
                <button id="dialogCancel" class="btn btn-secondary">Cancel</button>
                <button id="dialogConfirm" class="btn btn-primary">Use This Provider</button>
            </div>
        </div>
    </div>

    <!-- Load JavaScript modules -->
    <script src="js/accessibility.js"></script>
    <script src="js/voice-commands.js"></script>
    <script src="js/ai-analyzer.js"></script>
    <script src="js/capture-manager.js"></script>
    <script src="js/main.js"></script>
</body>
</html>