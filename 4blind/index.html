<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapture Accessible - Screen Capture for Blind Users</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <!-- Skip to main content for screen readers -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Voice command status indicator -->
    <div id="voice-status" class="voice-status" role="status" aria-live="polite" aria-label="Voice command status"></div>

    <div class="container">
        <header role="banner">
            <h1>Rapture Accessible</h1>
            <p>Voice-Enabled Screen Capture & AI Analysis for Blind Users</p>
            <div class="status-announcements" role="status" aria-live="polite" aria-label="System status"></div>
        </header>

        <main id="main-content" role="main">
            <!-- Status Announcements - Hidden at top for screen readers -->
            <div class="status-announcements" role="status" aria-live="polite" aria-label="System status" style="position: absolute; left: -9999px;"></div>

            <!-- Control Panel - Top Section -->
            <section class="control-panel" role="region" aria-labelledby="control-panel-heading">
                <h2 id="control-panel-heading">Rapture Accessible Control Panel</h2>

                <!-- System Status - Compact -->
                <div class="status-bar">
                    <div class="status-item">
                        <span class="status-label">Storage:</span>
                        <span class="status-value" id="storageUsed">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Memory:</span>
                        <span class="status-value" id="memoryUsage">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Captures:</span>
                        <span class="status-value" id="capturesCount">-</span>
                    </div>
                    <button id="speakStatus" class="btn btn-info btn-small" aria-describedby="speak-status-desc">
                        Speak Status
                    </button>
                </div>

                <!-- Main Controls -->
                <div class="main-controls">
                    <div class="control-group">
                        <h3>Screen Capture</h3>
                        <div class="button-group">
                            <button id="manualScreenCapture" class="btn btn-primary" aria-describedby="manual-screen-desc">
                                üì∏ Manual Screen Capture
                            </button>
                            <button id="autoCapture" class="btn btn-secondary" aria-describedby="auto-capture-desc">
                                üîÑ Auto Capture (3x)
                            </button>
                            <button id="emergencyCapture" class="btn btn-danger" aria-describedby="emergency-capture-desc">
                                üö® Emergency Capture
                            </button>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Video Recording</h3>
                        <div class="button-group">
                            <button id="manualVideoCapture" class="btn btn-primary" aria-describedby="manual-video-desc">
                                üé• Manual Video Capture
                            </button>
                            <button id="startRecording" class="btn btn-success" aria-describedby="start-recording-desc">
                                ‚è∫Ô∏è Start Recording
                            </button>
                            <button id="stopRecording" class="btn btn-danger" disabled aria-describedby="stop-recording-desc">
                                ‚èπÔ∏è Stop Recording
                            </button>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Analysis & Actions</h3>
                        <div class="button-group">
                            <button id="analyzeCurrent" class="btn btn-info" disabled aria-describedby="analyze-current-desc">
                                ü§ñ Analyze Current Capture
                            </button>
                            <button id="readAloud" class="btn btn-success" disabled aria-describedby="read-aloud-desc">
                                üîä Read Analysis Aloud
                            </button>
                            <button id="saveCapture" class="btn btn-primary" disabled aria-describedby="save-capture-desc">
                                üíæ Save Capture
                            </button>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Sequential Actions</h3>
                        <div class="button-group">
                            <button id="quickSequence" class="btn btn-secondary" aria-describedby="quick-sequence-desc">
                                ‚ö° Quick Sequence (Capture ‚Üí Analyze ‚Üí Save)
                            </button>
                            <button id="fullSequence" class="btn btn-secondary" aria-describedby="full-sequence-desc">
                                üîÑ Full Sequence (Screen ‚Üí Video ‚Üí Analyze ‚Üí Read ‚Üí Save)
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Countdown Timer -->
                <div class="countdown-section" id="countdownSection" style="display: none;">
                    <div class="countdown-display">
                        <span id="countdownText">Next action in:</span>
                        <span id="countdownTimer" class="timer">10</span>
                        <span>seconds</span>
                    </div>
                    <div class="countdown-controls">
                        <button id="pauseCountdown" class="btn btn-warning">‚è∏Ô∏è Pause</button>
                        <button id="stopCountdown" class="btn btn-danger">‚èπÔ∏è Stop</button>
                        <button id="resumeCountdown" class="btn btn-success" style="display: none;">‚ñ∂Ô∏è Resume</button>
                    </div>
                </div>

                <!-- Settings - Collapsible -->
                <details class="settings-details">
                    <summary>‚öôÔ∏è Settings & Configuration</summary>
                    <div class="settings-content">
                        <div class="setting-group">
                            <label for="autoAnalyzeToggle">Auto-analyze captures:</label>
                            <input type="checkbox" id="autoAnalyzeToggle" checked aria-describedby="auto-analyze-desc">
                        </div>

                        <div class="setting-group">
                            <label for="aiProviderSelect">AI Provider:</label>
                            <select id="aiProviderSelect" aria-describedby="ai-provider-desc">
                                <option value="gemini">Gemini (Free)</option>
                                <option value="huggingface">Hugging Face</option>
                                <option value="openai">OpenAI GPT-4</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label for="autoCaptureCount">Auto captures:</label>
                            <input type="number" id="autoCaptureCount" min="1" max="10" value="3">
                            <button id="updateAutoCaptureCount" class="btn btn-small">Update</button>
                        </div>

                        <div class="setting-group">
                            <label for="autoCaptureDelay">Delay (seconds):</label>
                            <input type="number" id="autoCaptureDelay" min="1" max="60" value="5">
                            <button id="updateAutoCaptureDelay" class="btn btn-small">Update</button>
                        </div>
                    </div>
                </details>
            </section>

            <!-- Live Preview & Analysis - Compact Layout -->
            <section class="preview-analysis-section" role="region" aria-labelledby="preview-heading">
                <div class="split-view">
                    <!-- Left: Preview -->
                    <div class="preview-panel">
                        <h3 id="preview-heading">Live Preview</h3>
                        <div class="preview-container">
                            <video id="previewVideo" autoplay muted style="display: none;" aria-label="Live video preview"></video>
                            <canvas id="previewCanvas" style="display: none;" aria-label="Screen capture preview"></canvas>
                            <img id="previewImage" alt="Screen capture preview" style="display: none;" aria-label="Screen capture image">
                            <div id="previewPlaceholder" class="preview-placeholder">
                                No preview available. Use capture buttons above to begin.
                            </div>
                        </div>
                    </div>

                    <!-- Right: Analysis -->
                    <div class="analysis-panel">
                        <h3>AI Analysis Results</h3>
                        <div class="analysis-content">
                            <textarea id="aiDescription" placeholder="AI analysis will appear here after capture..." readonly aria-label="AI analysis results"></textarea>
                        </div>
                        <div class="analysis-actions">
                            <button id="reanalyze" class="btn btn-small btn-secondary" disabled>üîÑ Re-analyze</button>
                            <button id="askQuestion" class="btn btn-small btn-info">‚ùì Ask Question</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Recent Captures - Compact Gallery -->
            <section class="captures-section" role="region" aria-labelledby="captures-heading">
                <div class="section-header">
                    <h3 id="captures-heading">Recent Captures</h3>
                    <div class="section-actions">
                        <button id="clearAll" class="btn btn-small btn-danger">üóëÔ∏è Clear All</button>
                        <button id="exportAll" class="btn btn-small btn-info">üìÑ Export</button>
                    </div>
                </div>
                <div id="capturesList" class="captures-grid" role="list" aria-label="Recent captures list"></div>
            </section>

            <!-- Voice Commands Help -->
            <section class="help-section" role="region" aria-labelledby="help-heading">
                <h2 id="help-heading">Voice Commands (Coming Soon)</h2>
                <details class="help-details">
                    <summary>Available Voice Commands</summary>
                    <div class="help-content">
                        <ul>
                            <li>"Capture screen" - Take a screenshot</li>
                            <li>"Start recording" - Begin screen recording</li>
                            <li>"Stop recording" - End current recording</li>
                            <li>"Analyze capture" - Run AI analysis on current capture</li>
                            <li>"Read description" - Speak the AI analysis aloud</li>
                            <li>"Save capture" - Save current capture to storage</li>
                            <li>"Clear all" - Remove all saved captures</li>
                            <li>"Speak status" - Announce current system status</li>
                        </ul>
                        <p><strong>Note:</strong> Voice commands will be enabled once speech recognition permissions are granted.</p>
                    </div>
                </details>
            </section>

            <!-- Processing Status -->
            <div class="processing-status" id="processingStatus" style="display: none;" role="status" aria-live="polite" aria-label="Processing status"></div>

            <!-- AI Conversation Interface -->
            <div class="ai-conversation" id="aiConversation" style="display: none;" role="region" aria-labelledby="conversation-heading">
                <h3 id="conversation-heading">AI Conversation</h3>
                <div class="conversation-messages" id="conversationMessages" role="log" aria-live="polite" aria-label="AI conversation messages"></div>
                <div class="conversation-input-container">
                    <label for="aiInput">Ask AI about the capture:</label>
                    <input type="text" id="aiInput" class="ai-input" placeholder="Type your question here..." aria-describedby="ai-input-desc">
                    <button id="sendAiMessage" class="btn btn-primary">Send Question</button>
                </div>
                <p id="ai-input-desc">Ask questions about the current capture or analysis</p>
            </div>

            <!-- Announcements Section - Bottom of Page -->
            <section class="announcements-section" role="region" aria-labelledby="announcements-heading">
                <h3 id="announcements-heading" class="sr-only">System Announcements</h3>
                <div class="announcements-container">
                    <div class="announcements-header">
                        <h4>üì¢ Recent Announcements</h4>
                        <button id="clearAnnouncements" class="btn btn-small btn-secondary">üóëÔ∏è Clear</button>
                    </div>
                    <div id="announcementsList" class="announcements-list" role="log" aria-live="polite" aria-label="Recent announcements"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- Load JavaScript modules -->
    <script src="js/accessibility.js"></script>
    <script src="js/voice-commands.js"></script>
    <script src="js/auto-capture.js"></script>
    <script src="js/ai-analyzer.js"></script>
    <script src="js/capture-manager.js"></script>
    <script src="js/main.js"></script>
</body>
</html>